<router-outlet *ngIf="!showForm"></router-outlet>

<p-toast></p-toast>

<div *ngIf="showForm" class="container">
  <p-card styleClass="registration-card">
    <ng-template pTemplate="header">
      <div class="card-header">
        <h1><i class="pi pi-car"></i> Registro de Vehículos</h1>
        <p>Complete el formulario para registrar su vehículo en el Pase del Niño Viajero</p>
      </div>
    </ng-template>

    <!-- Formulario -->
    <form [formGroup]="vehicleForm" (ngSubmit)="onSubmit()" class="registration-form">
      
      <!-- Sección de Datos Personales -->
      <div class="form-section">
        <h2 class="section-title">
          <i class="pi pi-user"></i>
          Datos Personales
        </h2>
        
        <div class="p-fluid p-formgrid p-grid">
          <!-- Nombre Completo -->
          <div class="p-field p-col-12 p-md-6">
            <label for="nombreCompleto">Nombre Completo</label>
            <input 
              pInputText 
              id="nombreCompleto" 
              formControlName="nombreCompleto"
              placeholder="Ingrese su nombre completo"
              [class.ng-invalid]="isSubmitted && f['nombreCompleto'].errors"
              [class.ng-dirty]="isSubmitted"
            />
            <small class="p-error" *ngIf="isSubmitted && f['nombreCompleto'].errors?.['required']">
              El nombre es requerido
            </small>
            <small class="p-error" *ngIf="isSubmitted && f['nombreCompleto'].errors?.['minlength']">
              El nombre debe tener al menos 3 caracteres
            </small>
          </div>

          <!-- Documento de Identificación -->
          <div class="p-field p-col-12 p-md-6">
            <label for="documentoIdentificacion">Documento de Identificación</label>
            <input 
              pInputText 
              id="documentoIdentificacion" 
              formControlName="documentoIdentificacion"
              placeholder="Ej: 12345678"
              [class.ng-invalid]="isSubmitted && f['documentoIdentificacion'].errors"
              [class.ng-dirty]="isSubmitted"
            />
            <small class="p-error" *ngIf="isSubmitted && f['documentoIdentificacion'].errors?.['required']">
              El documento es requerido
            </small>
            <small class="p-error" *ngIf="isSubmitted && f['documentoIdentificacion'].errors?.['pattern']">
              Debe contener entre 8 y 12 dígitos
            </small>
          </div>

          <!-- Teléfono -->
          <div class="p-field p-col-12 p-md-6">
            <label for="telefono">Número de Teléfono</label>
            <input 
              pInputText 
              id="telefono" 
              formControlName="telefono"
              placeholder="Ej: 3001234567"
              [class.ng-invalid]="isSubmitted && f['telefono'].errors"
              [class.ng-dirty]="isSubmitted"
            />
            <small class="p-error" *ngIf="isSubmitted && f['telefono'].errors?.['required']">
              El teléfono es requerido
            </small>
            <small class="p-error" *ngIf="isSubmitted && f['telefono'].errors?.['pattern']">
              Debe contener 10 dígitos
            </small>
          </div>

          <!-- Email -->
          <div class="p-field p-col-12 p-md-6">
            <label for="email">Correo Electrónico</label>
            <input 
              pInputText 
              id="email" 
              formControlName="email"
              placeholder="ejemplo@correo.com"
              [class.ng-invalid]="isSubmitted && f['email'].errors"
              [class.ng-dirty]="isSubmitted"
            />
            <small class="p-error" *ngIf="isSubmitted && f['email'].errors?.['required']">
              El email es requerido
            </small>
            <small class="p-error" *ngIf="isSubmitted && f['email'].errors?.['email']">
              Debe ser un email válido
            </small>
          </div>
        </div>
      </div>

      <!-- Sección de Datos del Vehículo -->
      <div class="form-section">
        <h2 class="section-title">
          <i class="pi pi-car"></i>
          Datos del Vehículo
        </h2>
        
        <div class="p-fluid p-formgrid p-grid">
          <!-- Temática -->
          <div class="p-field p-col-12">
            <label for="tematica">Temática del Carro Alegórico</label>
            <p-dropdown 
              id="tematica"
              formControlName="tematica"
              [options]="tematicas"
              optionLabel="label"
              optionValue="value"
              [group]="true"
              placeholder="Seleccione una temática"
              [class.ng-invalid]="isSubmitted && f['tematica'].errors"
              [class.ng-dirty]="isSubmitted"
            >
              <ng-template let-group pTemplate="group">
                <div class="p-d-flex p-ai-center">
                  <i class="pi pi-book p-mr-2"></i>
                  <span>{{ group.label }}</span>
                </div>
              </ng-template>
            </p-dropdown>
            <small class="p-error" *ngIf="isSubmitted && f['tematica'].errors?.['required']">
              La temática es requerida
            </small>
          </div>

          <!-- Campo condicional para detalles de temática -->
          <div class="p-field p-col-12" *ngIf="requiereDetalle()">
            <label for="tematicaDetalle">Especifique los detalles</label>
            <input 
              pInputText 
              id="tematicaDetalle" 
              formControlName="tematicaDetalle"
              placeholder="Describa los detalles de la temática seleccionada"
              [class.ng-invalid]="isSubmitted && requiereDetalle() && !f['tematicaDetalle'].value"
              [class.ng-dirty]="isSubmitted"
            />
            <small class="p-error" *ngIf="isSubmitted && requiereDetalle() && !f['tematicaDetalle'].value">
              Este campo es requerido para la temática seleccionada
            </small>
          </div>

          <!-- Placa -->
          <div class="p-field p-col-12 p-md-6">
            <label for="placa">Placa</label>
            <input 
              pInputText 
              id="placa" 
              formControlName="placa"
              placeholder="Ej: ABC123"
              style="text-transform: uppercase;"
              [class.ng-invalid]="isSubmitted && f['placa'].errors"
              [class.ng-dirty]="isSubmitted"
            />
            <small class="p-error" *ngIf="isSubmitted && f['placa'].errors?.['required']">
              La placa es requerida
            </small>
            <small class="p-error" *ngIf="isSubmitted && f['placa'].errors?.['pattern']">
              Formato: 3 letras seguidas de 3 números (Ej: ABC123)
            </small>
          </div>

          <!-- Tipo de Vehículo -->
          <div class="p-field p-col-12 p-md-6">
            <label for="tipoVehiculo">Tipo de Vehículo</label>
            <p-dropdown 
              id="tipoVehiculo"
              formControlName="tipoVehiculo"
              [options]="tiposVehiculo"
              placeholder="Seleccione el tipo de vehículo"
              [class.ng-invalid]="isSubmitted && f['tipoVehiculo'].errors"
              [class.ng-dirty]="isSubmitted"
            ></p-dropdown>
            <small class="p-error" *ngIf="isSubmitted && f['tipoVehiculo'].errors?.['required']">
              El tipo de vehículo es requerido
            </small>
          </div>

          <!-- Advertencia de vehículos no permitidos -->
          <div class="p-col-12">
            <div class="warning-card">
              <div class="warning-header">
                <i class="pi pi-exclamation-triangle"></i>
                <strong>Vehículos NO Permitidos</strong>
              </div>
              <div class="warning-content">
                <p>Los siguientes tipos de vehículos <strong>NO pueden participar</strong> en el evento:</p>
                <ul>
                  <li>Camiones de carga pesada</li>
                  <li>Vehículos de doble eje</li>
                  <li>Cabezales y tráiler</li>
                  <li>Buses y busetas</li>
                  <li>Volquetas</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Botones de Acción -->
      <div class="form-actions">
        <p-button 
          label="Limpiar" 
          icon="pi pi-refresh" 
          styleClass="p-button-secondary"
          (onClick)="resetForm()" 
          [disabled]="isLoading"
        ></p-button>
        <p-button 
          label="{{ isLoading ? 'Guardando...' : 'Registrar' }}" 
          icon="{{ isLoading ? 'pi pi-spin pi-spinner' : 'pi pi-save' }}"
          type="submit"
          [disabled]="isLoading"
          [loading]="isLoading"
        ></p-button>
      </div>
    </form>
  </p-card>
</div>
