<div class="admin-container">
	<p-card styleClass="admin-card">
		<div class="admin-header">
			<h2>Panel de Administración</h2>
			<div class="actions">
				<p-button 
					label="Validar Códigos QR" 
					icon="pi pi-qrcode"
					(onClick)="irAValidacion()"
					styleClass="p-button-success"
				></p-button>
				<p-button 
					label="Cerrar sesión" 
					icon="pi pi-sign-out"
					(onClick)="logout()"
					styleClass="p-button-secondary"
				></p-button>
			</div>
		</div>

		<div *ngIf="loading" class="loading-message">
			<i class="pi pi-spin pi-spinner" style="font-size: 2rem"></i>
			<p>Cargando registros...</p>
		</div>

		<!-- Buscador -->
		<div *ngIf="!loading" class="search-container">
			<span class="p-input-icon-left">
				<i class="pi pi-search"></i>
				<input 
					type="text" 
					pInputText
					placeholder="Buscar cédula" 
					[(ngModel)]="busquedaCedula"
					(input)="filtrarVehiculos()"
					class="search-input"
				/>
			</span>
			<p-button 
				*ngIf="busquedaCedula" 
				(onClick)="limpiarBusqueda()"
				icon="pi pi-times"
				styleClass="p-button-rounded p-button-text clear-btn-prime"
			></p-button>
			<p class="search-results" *ngIf="busquedaCedula">
				Mostrando {{ vehiculosFiltrados.length }} de {{ vehiculos.length }} registros
			</p>
		</div>

		<p-table 
			*ngIf="!loading && vehiculosFiltrados.length" 
			[value]="vehiculosFiltrados" 
			styleClass="p-datatable-sm p-datatable-striped"
			[scrollable]="true"
			scrollHeight="600px"
		>
			<ng-template pTemplate="header">
				<tr>
					<th>Nombre Completo</th>
					<th>Nombre del Grupo</th>
					<th>Documento</th>
					<th>Teléfono</th>
					<th>Email</th>
					<th>Temática</th>
					<th>Tipo Vehículo</th>
					<th>Placa</th>
					<th>Fecha Registro</th>
					<th>Validado</th>
					<th>Fecha Validación</th>
					<th>Validado Por</th>
					<th>Acciones</th>
				</tr>
			</ng-template>
			<ng-template pTemplate="body" let-v>
				<tr>
					<td>{{ v.nombreCompleto }}</td>
					<td>{{ v.nombreGrupo }}</td>
					<td>{{ v.documentoIdentificacion }}</td>
					<td>{{ v.telefono }}</td>
					<td>{{ v.email }}</td>
					<td>{{ v.tematica }}</td>
					<td>{{ v.tipoVehiculo }}</td>
					<td><p-tag [value]="v.placa" styleClass="placa-tag"></p-tag></td>
					<td>{{ v.fechaRegistro?.toDate?.() | date:'short' }}</td>
					<td>
						<p-tag 
							[value]="v.validado ? 'Validado' : 'Pendiente'" 
							[severity]="v.validado ? 'success' : 'danger'"
						></p-tag>
					</td>
					<td>{{ v.validadoAt ? (v.validadoAt?.toDate?.() | date:'short') : '-' }}</td>
					<td>{{ v.validadoPor || '-' }}</td>
					<td>
						<p-button 
							icon="pi pi-trash" 
							(onClick)="eliminar(v.id)"
							styleClass="p-button-rounded p-button-danger p-button-text"
							pTooltip="Eliminar registro"
							tooltipPosition="left"
						></p-button>
					</td>
				</tr>
			</ng-template>
		</p-table>

		<p-message 
			*ngIf="!loading && !vehiculos.length" 
			severity="info" 
			text="No hay registros aún."
			styleClass="empty-message"
		></p-message>
		<p-message 
			*ngIf="!loading && vehiculos.length && !vehiculosFiltrados.length" 
			severity="warn" 
			text="No se encontraron registros con ese número de cédula."
			styleClass="empty-message"
		></p-message>
	</p-card>
</div>
